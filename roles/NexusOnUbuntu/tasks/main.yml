---
# tasks file for NexusOnUbuntu
- name: Install required system packages
  apt:
    name: { { item } }
    state: latest
    update_cache: yes
  loop: ["openjdk-8-jdk", "wget"]

- name: Create a directory if it does not exist
  file:
    path: "{{ nexus_path }}"
    state: directory

- name: Unpack Nexus
  unarchive:
    src: "{{ nexus_url }}{{ nexus_package }}"
    dest: "{{ nexus_path }}"
    remote_src: True

- name: Create a symbolic link from "{{ nexus_folder }}" to a "nexus"
  file:
    src: "{{ nexus_path }}/{{ nexus_folder }}"
    dest: "{{ nexus_path }}/nexus"
    state: link

- name: Ensure Nexus o/s group exists
  group:
    name: nexus
    state: present

- name: Ensure Nexus o/s user exists
  user:
    name: nexus
    group: nexus
    home: "{{ nexus_path }}"
    shell: "/bin/bash"
    state: present

- name: Change file owner
  file:
    path: "{{ nexus_path }}"
    owner: nexus
    group: nexus
    recurse: yes

- name: Copying Nexus service file
  copy:
    src: nexus.service
    dest: /etc/systemd/system/
    mode: "744"

- name: Start service Nexus
  systemd:
    name: nexus
    state: started
    daemon_reload: yes
    enabled: yes

- name: Restart service Nexus
  systemd:
    name: nexus
    state: restarted
    daemon_reload: yes
    enabled: yes

- name: Get admin user password
  shell: cat "{{ nexus_pass_file }}"
  register: admpass

- name: Show admin user password
  debug:
    var: admpass.stdout
